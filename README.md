=========
photonica
=========

Camera performance analyser presented as python module pythonica. 

References for this process can be found in the references folder.

Thank you to Richard Crisp for sharing the analysis process.

Installation
--------

Requires: Python3.6+

The following command should get the job done:

```bash
pip install git+https://github.com/gschwim/photonica.git
```


Use
--------

After installation open a cli and execute as follows:

```bash
Usage: photonica [OPTIONS]

  Console script for photonica.

Options:
  -d, --datapath TEXT             Path for data directory.  [required]
  -o, --offset_correction INTEGER
                                  Offset correction to use. Default = 0
  -c, --cropsize TUPLE            Crop size in (x, y) format. Default=(100,
                                  100).
  -p, --pedestal INTEGER          Pedestal to use in ADU. Default = 10000
  --help                          Show this message and exit.


schwim@mel15:~$photonica --datapath='./some_path_to_your_data/'
Importing from /home/schwim/Dropbox/Astrophotography/sensor_characterization/data
Added file: Dark.1200.000secs.1x1.-10.00C.00034267.fit
Added file: Dark.300.000secs.1x1.-15.00C.00034274.fit
Added file: Dark.60.000secs.1x1.-25.00C.00034301.fit
Added file: Dark.60.000secs.1x1.-10.00C.00034258.fit
Added file: Dark.300.000secs.1x1.-10.00C.00034261.fit
Added file: Dark.600.000secs.1x1.-15.00C.00034277.fit
Added file: Bias.1x1.-30.00C.00034314.fit
...
```

This will create two csv files in the local directory named after the primary stats tables generated by the code. These tables are pandas dataframes and are be saved out to csv for spreadsheet analysis. These tables are as follows:

* data_set - individual frame stats, includes:
** file name
** img_type - bias, dark, flat, light, established from the fits header
** exptime - exposure time, fits header
** ccd_temp - ccd temperature, fits header
** ff_geometry - measured geometry of the full image matrix
** crop_geometry - crop used for analysis
** offset - per the procedure
** min - min measured value in the crop
** max - max
** signal - mean value of the crop
** std_dev - standard deviation of the crop
** signal-offset - per the procedure
** read(DN) - per the procedure
** data - raw data from the crop

* data_summary - aggregated results by temperature and exposure time
** ccd_temp
** exp_time 
** img_type
** avg_signal-offset
** delta_std_dev
** total_noise
** shot+read
** read(DN)
** FPN
** sig_shot
** offset_correction used

Reference test_run.py in the source code if you want to customize the workflow. In short:

```python
import photonica

# source directory for fits images here
datadir = './data'

d = photonica.SensorData(offset_correction=100)  # whatever options you desire

d.addFiles(datadir)  # add files to the tables

d.calcStats()  # calculate the summary stats tables

d.data_summary.to_csv('data_summary.csv')  # saves out to csv
```

NOTE: when creating the SensorData object you can set cropsize, offset_correction, and pedestal values as follows:

```python
x = photonica.SensorData(cropsize=(500,500), offset_correction=150, pedestal=10000)
```

Features
--------

* Loads fits files, auto-crops, builds statistics table
* Runs analysis on data, grouped by temperature and exposure

TODO
--------

 * Verify proper counts of each file type
 * Minimum Practical Exposure Time calculation
 * graphing
 * full report generation

 
